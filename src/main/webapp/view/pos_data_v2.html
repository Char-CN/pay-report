<div>
	<form class="layui-form">
		<div class="layui-form-item">
			&nbsp;
			<div class="layui-inline" id="select_div">
			</div>
			<div class="layui-inline">
				日期范围
			</div>
			<div class="layui-inline" id="date_div">
			</div>
			<div class="layui-inline">
				<select id="type">
					<option value="全部" selected>全部</option>
					<option value="借记卡">借记卡</option>
					<option value="贷记卡">贷记卡</option>
				</select>
			</div>
			<div class="layui-inline">
				<button class="layui-btn" lay-submit lay-filter="search">查询</button>
			</div>
<!-- 			<div class="layui-inline"> -->
<!-- 				<button class="layui-btn" lay-submit lay-filter="export">导出</button> -->
<!-- 			</div> -->
		</div>
	</form>
	<div id="charts"></div>
	<table id="table" class="layui-table">
	</table>
</div>

<script>
	$(function() {
		$("#charts").width($("#center").width() - 10);
		$("#charts").height($("#center").height() / 1.2 - 10);
		var today = new XDate().addDays(-1).toString("yyyy-MM-dd");
		$('#select_div').append('<select id="select" lay-ignore style="width:0px;height:35px;"></select>');
// 		$('#select').combotree();
		$('#select').combotree({
			panelWidth : 300,
			panelHeight : $("#center").height() - 60,
			data :[{
				id: 1,
				text: 'Languages',
				children: [{
					id: 11,
					text: 'Java'
				},{
					id: 12,
					text: 'C++'
				}]
			}]
		});
// 		.combotree('loadData', [{
// 			id: 1,
// 			text: 'Languages',
// 			children: [{
// 				id: 11,
// 				text: 'Java'
// 			},{
// 				id: 12,
// 				text: 'C++'
// 			}]
// 		}]);
		/* 初始化方法 */
		var init = function() {
			/* 加载表单 */
			var form = layui.form;
			form.render();
			form.on('submit(search)', function(data) {
				search();
				return false;
			});
// 			form.on('submit(export)', function(data) {
// 				tableToExcel('table', 'data');
// 				return false;
// 			});
			refer_date_div();
			/* 查询默认数据 */
			search();
		};
		var refer_date_div = function() {
			var laydate = layui.laydate;
			$("#date_div").empty();
			$("#date_div").append('<input type="text" class="layui-input" style="width:180px;" id="date">');
			laydate.render({
				elem: '#date',
				max : -1,
				range: true,
				btns : [ 'confirm' ]
			});
			$("#date").val(today + " - " + today);
		};
		var search = function() {
			var day = $("#date").val();
			if (day == "") {
				layer.open({
					title : '提示',
					content : '请选择日期！'
				});
				return false;
			}

			var shade_index = layer.load(1, {
				shade: [0.3,'#fff'] //0.1透明度的白色背景
			});
			var myChart = echarts.init(document.getElementById('charts'));
			var rstMap = {};
			var rstKeys = [];
			$.get("http://ds.idc.xiwanglife.com/dataservice/getconfig.do?id=223&para1=&para2=&para3=&para4=2017-08-01&para5=2017-08-05&para6=",
				function(data) {
//						alert(JSON.stringify(data));
					var details = data.details.day.values;
					rstMap = $DSUtil.ConvertDetailsToMap(details);
					rstKeys = $DSUtil.GetDetailsKeys(details);
					series = [ ];
					for (var i in rstMap) {
						series.push({
							name : 'amt_tot',
							type : 'line',
							data : rstMap['amt_tot']
						});
						rstMap[i]
					}
// 					alert(rstKeys);
					option = {
						tooltip : {
							trigger : 'axis',
							axisPointer : {
								type : 'cross',
								crossStyle : {
									color : '#999'
								}
							}
						},
						toolbox : {
							feature : {
								dataView : {
									show : true,
									readOnly : false
								},
								magicType : {
									show : true,
									type : [ 'line', 'bar' ]
								},
								restore : {
									show : true
								},
								saveAsImage : {
									show : true
								}
							}
						},
						legend : {
							data : [ 'amt_tot', 'amt_cc', 'amt_dc' ]
						},
						xAxis : [ {
							type : 'category',
							data : rstMap['time_key'],
							axisPointer : {
								type : 'shadow'
							}
						} ],
						yAxis : [ {
							type : 'value',
							name : '金额',
							axisLabel : {
								formatter : '{value} 元'
							}
						} ],
						series : [ {
							name : 'amt_tot',
							type : 'bar',
							data : rstMap['amt_tot']
						}, {
							name : 'amt_cc',
							type : 'bar',
							data : rstMap['amt_cc']
						}, {
							name : 'amt_dc',
							type : 'bar',
							data : rstMap['amt_dc']
						} ]
					};

					// 使用刚指定的配置项和数据显示图表。
					myChart.setOption(option);
					layer.closeAll('loading');
				});
			/* var days = day.split(" - ");
			var url = "";
			if (btn_type == "by_range") {
				url = 'http://ds.idc.xiwanglife.com/dataservice/getconfig.do?id=205&begin_date=' + days[0].replace(/-/gi, "") + '&end_date=' + days[1].replace(/-/gi, "");
			} else {
				url = 'http://ds.idc.xiwanglife.com/dataservice/getconfig.do?id=205&begin_date=' + days[0].replace(/-/gi, "");
			}
			var shade_index = layer.load(1, {
				shade: [0.3,'#fff'] //0.1透明度的白色背景
			});
			$.ajax({
				type : 'post',
				url : url,
				crossDomain : true,
				jsonpCallback : "sucCallback",
				success : function(data) {
					$("#table").empty();
					var values = null;
					var type_name = "";
					if (btn_type == "by_range") {
						values = data.details.range.values;
						type_name = "日期范围";
					} else {
						values = data.details.total.values;
						type_name = "历史累计";
					}
					if (values.length == 0) {
						layer.open({
							title : '提示',
							content : '没有任何数据！'
						});
					}
					var type = $("#type").val();
					var value = values[0];

					$("#table").append("<tr style='background-color:#ddeaff'><td width='50%'>数据类型</td><td width='50%'>" + type_name + "</td></tr>");
					$("#table").append("<tr style='background-color:#ddeaff'><td>结算时间</td><td>" + day + "</td></tr>");

					$("#table").append("<tr style='background-color:#fff3dd'><td>总交易笔数</td><td>" + (value == undefined ? "" : value.cnt_tot) + "</td></tr>");
					$("#table").append("<tr style='background-color:#fff3dd'><td>总交易金额</td><td>" + (value == undefined ? "" : value.amt_tot) + "</td></tr>");
					$("#table").append("<tr style='background-color:#fff3dd'><td>总交易手续费</td><td>" + (value == undefined ? "" : value.fee_tot) + "</td></tr>");
					$("#table").append("<tr style='background-color:#fff3dd'><td>总分润金额</td><td>" + (value == undefined ? "" : value.profit_tot) + "</td></tr>");
					$("#table").append("<tr style='background-color:#fff3dd'><td>恒大总分润金额</td><td>" + (value == undefined ? "" : value.profit_hengda) + "</td></tr>");
					$("#table").append("<tr style='background-color:#fff3dd'><td>杉德总分润金额</td><td>" + (value == undefined ? "" : value.profit_shande) + "</td></tr>");

					if (type == "全部" || type == "借记卡") {
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡交易笔数</td><td>" + (value == undefined ? "" : value.cnt_cc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡交易金额</td><td>" + (value == undefined ? "" : value.amt_cc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡交易手续费</td><td>" + (value == undefined ? "" : value.fee_cc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡总分润金额</td><td>" + (value == undefined ? "" : value.profit_cc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡恒大分润金额</td><td>" + (value == undefined ? "" : value.profit_hengda_cc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#f1ffdd'><td>借记卡彬德分润金额</td><td>" + (value == undefined ? "" : value.profit_shande_cc) + "</td></tr>");
					}

					if (type == "全部" || type == "贷记卡") {
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡交易笔数</td><td>" + (value == undefined ? "" : value.cnt_dc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡交易金额</td><td>" + (value == undefined ? "" : value.amt_dc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡交易手续费</td><td>" + (value == undefined ? "" : value.fee_dc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡总分润金额</td><td>" + (value == undefined ? "" : value.profit_dc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡恒大分润金额</td><td>" + (value == undefined ? "" : value.profit_hengda_dc) + "</td></tr>");
						$("#table").append("<tr style='background-color:#edfcff'><td>贷记卡彬德分润金额</td><td>" + (value == undefined ? "" : value.profit_shande_dc) + "</td></tr>");
					}
					layer.closeAll('loading');
				},
				error : function(data) {
					alert(JSON.stringify(data));
				}
			}); */
		};
		init();
	});
</script>